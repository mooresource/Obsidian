--// premium-ui.lua

local PremiumUI = {}
PremiumUI.__index = PremiumUI

--// Dependencies
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

--// Configuration
local Config = {
    Themes = {
        Dark = {
            Primary = Color3.fromRGB(15, 17, 22),
            Secondary = Color3.fromRGB(25, 28, 35),
            Tertiary = Color3.fromRGB(35, 38, 45),
            Accent = Color3.fromRGB(0, 145, 255),
            Text = Color3.fromRGB(245, 247, 250),
            SubText = Color3.fromRGB(160, 165, 175),
            Border = Color3.fromRGB(45, 50, 60, 0.15),
            Divider = Color3.fromRGB(50, 55, 65, 0.3),
            Success = Color3.fromRGB(46, 204, 113),
            Error = Color3.fromRGB(231, 76, 60),
            Warning = Color3.fromRGB(241, 196, 15),
            Info = Color3.fromRGB(52, 152, 219)
        },
        Midnight = {
            Primary = Color3.fromRGB(10, 12, 18),
            Secondary = Color3.fromRGB(20, 23, 30),
            Tertiary = Color3.fromRGB(30, 33, 40),
            Accent = Color3.fromRGB(155, 89, 182),
            Text = Color3.fromRGB(235, 237, 240),
            SubText = Color3.fromRGB(140, 145, 155)
        }
    },
    
    Window = {
        Size = {600, 450},
        MinSize = {400, 300},
        MaxSize = {1200, 800},
        CornerRadius = 12,
        ShadowBlur = 24,
        ShadowTransparency = 0.8,
        Padding = 16
    },
    
    TitleBar = {
        Height = 48,
        Font = Enum.Font.GothamSemibold,
        TitleSize = 20,
        SubTitleSize = 14
    },
    
    Sidebar = {
        Width = 180,
        ItemHeight = 42,
        IconSize = 20,
        Font = Enum.Font.Gotham,
        FontSize = 14
    },
    
    Elements = {
        Height = 42,
        Font = Enum.Font.Gotham,
        FontSize = 14,
        CornerRadius = 8,
        IconSize = 20,
        Padding = 12,
        Spacing = 8
    },
    
    Notifications = {
        MaxCount = 5,
        Duration = 5,
        Width = 350,
        Height = 80,
        Spacing = 12
    }
}

--// Internal State
local ActiveWindows = {}
local ActiveNotifications = {}
local CurrentTheme = "Dark"

--// Utility Functions
local function Create(className, properties)
    local instance = Instance.new(className)
    
    for property, value in pairs(properties) do
        if property ~= "Parent" then
            if typeof(value) == "Color3" then
                instance[property] = Color3.new(value.R, value.G, value.B)
            else
                instance[property] = value
            end
        end
    end
    
    if properties.Parent then
        instance.Parent = properties.Parent
    end
    
    return instance
end

local function ApplyCorner(instance, radius)
    local corner = Create("UICorner", {
        CornerRadius = UDim.new(0, radius or Config.Elements.CornerRadius),
        Parent = instance
    })
    return corner
end

local function ApplyStroke(instance, color, thickness)
    local stroke = Create("UIStroke", {
        Parent = instance,
        Color = color or Config.Themes[CurrentTheme].Border,
        Thickness = thickness or 1,
        Transparency = 0.5
    })
    return stroke
end

local function ApplyPadding(instance, left, top, right, bottom)
    local padding = Create("UIPadding", {
        Parent = instance,
        PaddingLeft = UDim.new(0, left or 0),
        PaddingTop = UDim.new(0, top or 0),
        PaddingRight = UDim.new(0, right or 0),
        PaddingBottom = UDim.new(0, bottom or 0)
    })
    return padding
end

local function ApplyListLayout(instance, padding, horizontalAlignment)
    local layout = Create("UIListLayout", {
        Parent = instance,
        Padding = UDim.new(0, padding or Config.Elements.Spacing),
        SortOrder = Enum.SortOrder.LayoutOrder,
        HorizontalAlignment = horizontalAlignment or Enum.HorizontalAlignment.Left
    })
    return layout
end

local function CreateIcon(parent, icon, size, color)
    local iconLabel = Create("TextLabel", {
        Parent = parent,
        BackgroundTransparency = 1,
        Text = icon,
        TextColor3 = color or Config.Themes[CurrentTheme].SubText,
        TextSize = size or Config.Elements.IconSize,
        Font = Enum.Font.GothamSemibold,
        Size = UDim2.new(0, size, 0, size),
        TextXAlignment = Enum.TextXAlignment.Center,
        TextYAlignment = Enum.TextYAlignment.Center
    })
    return iconLabel
end

local function CreateShadow(instance)
    local shadow = Create("ImageLabel", {
        Parent = instance,
        Size = UDim2.new(1, Config.Window.ShadowBlur, 1, Config.Window.ShadowBlur),
        Position = UDim2.new(0, -Config.Window.ShadowBlur/2, 0, -Config.Window.ShadowBlur/2),
        BackgroundTransparency = 1,
        Image = "rbxassetid://5554236805",
        ImageColor3 = Color3.new(0, 0, 0),
        ImageTransparency = Config.Window.ShadowTransparency,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(23, 23, 277, 277)
    })
    return shadow
end

--// Notification System
local NotificationService = {}

function NotificationService:Create(notificationData)
    local theme = Config.Themes[CurrentTheme]
    
    local notification = Create("Frame", {
        Name = "Notification",
        Parent = game:GetService("CoreGui"),
        Size = UDim2.new(0, Config.Notifications.Width, 0, Config.Notifications.Height),
        Position = UDim2.new(1, -Config.Notifications.Width - 20, 1, -Config.Notifications.Height - 20),
        BackgroundColor3 = theme.Secondary,
        BorderSizePixel = 0
    })
    
    ApplyCorner(notification, 8)
    ApplyStroke(notification)
    
    local content = Create("Frame", {
        Parent = notification,
        Size = UDim2.new(1, -20, 1, -20),
        Position = UDim2.new(0, 10, 0, 10),
        BackgroundTransparency = 1
    })
    
    ApplyPadding(content, 8, 8, 8, 8)
    ApplyListLayout(content, 6)
    
    local title = Create("TextLabel", {
        Parent = content,
        Size = UDim2.new(1, 0, 0, 20),
        BackgroundTransparency = 1,
        Text = notificationData.Title or "Notification",
        TextColor3 = theme.Text,
        TextSize = 16,
        Font = Enum.Font.GothamSemibold,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Center
    })
    
    local message = Create("TextLabel", {
        Parent = content,
        Size = UDim2.new(1, 0, 0, 16),
        BackgroundTransparency = 1,
        Text = notificationData.Content or "",
        TextColor3 = theme.SubText,
        TextSize = 14,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Center,
        TextWrapped = true
    })
    
    local progressBar = Create("Frame", {
        Parent = notification,
        Size = UDim2.new(0, 0, 0, 2),
        Position = UDim2.new(0, 0, 1, -2),
        BackgroundColor3 = theme.Accent,
        BorderSizePixel = 0
    })
    
    ApplyCorner(progressBar, 1)
    
    -- Animation
    notification.Position = UDim2.new(1, Config.Notifications.Width + 20, 1, -Config.Notifications.Height - 20)
    
    TweenService:Create(notification, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Position = UDim2.new(1, -Config.Notifications.Width - 20, 1, -Config.Notifications.Height - 20)
    }):Play()
    
    TweenService:Create(progressBar, TweenInfo.new(notificationData.Duration or Config.Notifications.Duration, Enum.EasingStyle.Linear), {
        Size = UDim2.new(1, 0, 0, 2)
    }):Play()
    
    task.spawn(function()
        task.wait(notificationData.Duration or Config.Notifications.Duration)
        
        TweenService:Create(notification, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Position = UDim2.new(1, Config.Notifications.Width + 20, 1, -Config.Notifications.Height - 20)
        }):Play()
        
        task.wait(0.3)
        notification:Destroy()
    end)
    
    return notification
end

--// Window Class
local Window = {}
Window.__index = Window

function Window.new(title, options)
    local self = setmetatable({}, Window)
    
    self.Title = title or "Premium UI"
    self.Options = options or {}
    self.Tabs = {}
    self.ActiveTab = nil
    self.Visible = true
    self.TabCount = 0
    
    self:InitializeUI()
    self:SetupDrag()
    
    table.insert(ActiveWindows, self)
    
    return self
end

function Window:InitializeUI()
    local theme = Config.Themes[CurrentTheme]
    
    -- Create main screen GUI
    self.ScreenGui = Create("ScreenGui", {
        Name = "PremiumUI_" .. self.Title,
        Parent = game:GetService("CoreGui"),
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    })
    
    -- Container
    self.Container = Create("Frame", {
        Parent = self.ScreenGui,
        Size = UDim2.new(0, Config.Window.Size[1], 0, Config.Window.Size[2]),
        Position = UDim2.new(0.5, -Config.Window.Size[1]/2, 0.5, -Config.Window.Size[2]/2),
        BackgroundTransparency = 1
    })
    
    -- Shadow
    CreateShadow(self.Container)
    
    -- Main window
    self.MainFrame = Create("Frame", {
        Parent = self.Container,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = theme.Primary,
        BorderSizePixel = 0
    })
    
    ApplyCorner(self.MainFrame, Config.Window.CornerRadius)
    
    -- Title bar
    self:CreateTitleBar()
    
    -- Sidebar
    self:CreateSidebar()
    
    -- Content area
    self:CreateContentArea()
end

function Window:CreateTitleBar()
    local theme = Config.Themes[CurrentTheme]
    
    self.TitleBar = Create("Frame", {
        Parent = self.MainFrame,
        Size = UDim2.new(1, 0, 0, Config.TitleBar.Height),
        BackgroundColor3 = theme.Secondary,
        BorderSizePixel = 0
    })
    
    ApplyCorner(self.TitleBar, Config.Window.CornerRadius)
    
    local titleContent = Create("Frame", {
        Parent = self.TitleBar,
        Size = UDim2.new(1, -40, 1, 0),
        Position = UDim2.new(0, 20, 0, 0),
        BackgroundTransparency = 1
    })
    
    self.TitleLabel = Create("TextLabel", {
        Parent = titleContent,
        Size = UDim2.new(1, 0, 0.6, 0),
        BackgroundTransparency = 1,
        Text = self.Title,
        TextColor3 = theme.Text,
        TextSize = Config.TitleBar.TitleSize,
        Font = Config.TitleBar.Font,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Bottom
    })
    
    if self.Options.SubTitle then
        self.SubTitleLabel = Create("TextLabel", {
            Parent = titleContent,
            Size = UDim2.new(1, 0, 0.4, 0),
            Position = UDim2.new(0, 0, 0.6, 0),
            BackgroundTransparency = 1,
            Text = self.Options.SubTitle,
            TextColor3 = theme.SubText,
            TextSize = Config.TitleBar.SubTitleSize,
            Font = Enum.Font.Gotham,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextYAlignment = Enum.TextYAlignment.Top
        })
    end
end

function Window:CreateSidebar()
    local theme = Config.Themes[CurrentTheme]
    
    self.Sidebar = Create("Frame", {
        Parent = self.MainFrame,
        Size = UDim2.new(0, Config.Sidebar.Width, 1, -Config.TitleBar.Height),
        Position = UDim2.new(0, 0, 0, Config.TitleBar.Height),
        BackgroundColor3 = theme.Secondary,
        BorderSizePixel = 0
    })
    
    self.TabList = Create("ScrollingFrame", {
        Parent = self.Sidebar,
        Size = UDim2.new(1, 0, 1, -60),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        ScrollBarThickness = 2,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        AutomaticCanvasSize = Enum.AutomaticSize.Y
    })
    
    ApplyPadding(self.TabList, 8, 8, 8, 8)
    ApplyListLayout(self.TabList, 4)
end

function Window:CreateContentArea()
    local theme = Config.Themes[CurrentTheme]
    
    self.ContentArea = Create("Frame", {
        Parent = self.MainFrame,
        Size = UDim2.new(1, -Config.Sidebar.Width, 1, -Config.TitleBar.Height),
        Position = UDim2.new(0, Config.Sidebar.Width, 0, Config.TitleBar.Height),
        BackgroundColor3 = theme.Primary,
        BorderSizePixel = 0,
        ClipsDescendants = true
    })
    
    ApplyCorner(self.ContentArea, Config.Window.CornerRadius)
    
    self.ContentScroll = Create("ScrollingFrame", {
        Parent = self.ContentArea,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        ScrollBarThickness = 4,
        ScrollBarImageColor3 = theme.Divider,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        AutomaticCanvasSize = Enum.AutomaticSize.Y
    })
    
    ApplyPadding(self.ContentScroll, Config.Window.Padding, Config.Window.Padding, Config.Window.Padding, Config.Window.Padding)
end

function Window:SetupDrag()
    local dragging = false
    local dragStart, startPos
    
    self.TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = self.Container.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            self.Container.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
end

function Window:CreateTab(tabData)
    local theme = Config.Themes[CurrentTheme]
    
    local tab = {
        Id = "Tab_" .. self.TabCount,
        Title = tabData.Title or "Tab",
        Icon = tabData.Icon or "",
        Priority = tabData.Priority or self.TabCount + 1,
        Sections = {},
        Active = false
    }
    
    self.TabCount = self.TabCount + 1
    
    -- Create sidebar button
    local tabButton = Create("TextButton", {
        Parent = self.TabList,
        Size = UDim2.new(1, 0, 0, Config.Sidebar.ItemHeight),
        BackgroundColor3 = theme.Primary,
        Text = "",
        AutoButtonColor = false,
        BorderSizePixel = 0,
        LayoutOrder = tab.Priority
    })
    
    ApplyCorner(tabButton, 6)
    
    if tab.Icon ~= "" then
        local iconLabel = CreateIcon(tabButton, tab.Icon, Config.Sidebar.IconSize)
        iconLabel.Position = UDim2.new(0, 12, 0.5, -Config.Sidebar.IconSize/2)
    end
    
    local textOffset = tab.Icon ~= "" and (Config.Sidebar.IconSize + 20) or 12
    
    local buttonLabel = Create("TextLabel", {
        Parent = tabButton,
        Size = UDim2.new(1, -textOffset, 1, 0),
        Position = UDim2.new(0, textOffset, 0, 0),
        BackgroundTransparency = 1,
        Text = tab.Title,
        TextColor3 = theme.SubText,
        TextSize = Config.Sidebar.FontSize,
        Font = Config.Sidebar.Font,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Center
    })
    
    -- Create content frame
    local contentFrame = Create("Frame", {
        Parent = self.ContentScroll,
        Size = UDim2.new(1, 0, 0, 0),
        BackgroundTransparency = 1,
        Visible = false
    })
    
    ApplyListLayout(contentFrame, Config.Elements.Spacing)
    
    -- Tab button click handler
    tabButton.MouseButton1Click:Connect(function()
        self:SwitchTab(tab)
    end)
    
    -- Store references
    tab.Button = tabButton
    tab.ContentFrame = contentFrame
    tab.ButtonLabel = buttonLabel
    
    -- Initialize as first tab if needed
    if #self.Tabs == 0 then
        self:SwitchTab(tab)
    end
    
    table.insert(self.Tabs, tab)
    
    -- Return tab interface
    local tabInterface = {}
    
    function tabInterface:CreateSection(sectionData)
        local section = {
            Title = sectionData.Title,
            Description = sectionData.Description,
            Elements = {}
        }
        
        local sectionContainer = Create("Frame", {
            Parent = contentFrame,
            Size = UDim2.new(1, 0, 0, 0),
            BackgroundTransparency = 1
        })
        
        ApplyListLayout(sectionContainer, Config.Elements.Spacing)
        
        -- Section header
        if section.Title then
            local header = Create("Frame", {
                Parent = sectionContainer,
                Size = UDim2.new(1, 0, 0, section.Description and 36 or 24),
                BackgroundTransparency = 1
            })
            
            local titleLabel = Create("TextLabel", {
                Parent = header,
                Size = section.Description and UDim2.new(1, 0, 0, 20) or UDim2.new(1, 0, 1, 0),
                BackgroundTransparency = 1,
                Text = string.upper(section.Title),
                TextColor3 = theme.SubText,
                TextSize = 12,
                Font = Enum.Font.GothamSemibold,
                TextXAlignment = Enum.TextXAlignment.Left,
                TextYAlignment = Enum.TextYAlignment.Center
            })
            
            if section.Description then
                local descriptionLabel = Create("TextLabel", {
                    Parent = header,
                    Size = UDim2.new(1, 0, 0, 16),
                    Position = UDim2.new(0, 0, 0, 20),
                    BackgroundTransparency = 1,
                    Text = section.Description,
                    TextColor3 = theme.SubText,
                    TextSize = 12,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    TextYAlignment = Enum.TextYAlignment.Top
                })
            end
        end
        
        section.Container = sectionContainer
        table.insert(tab.Sections, section)
        
        -- Section methods
        local sectionInterface = {}
        
        function sectionInterface:AddButton(buttonData)
            local button = self:CreateElement("Button", buttonData)
            return button
        end
        
        function sectionInterface:AddToggle(toggleData)
            local toggle = self:CreateElement("Toggle", toggleData)
            return toggle
        end
        
        function sectionInterface:AddSlider(sliderData)
            local slider = self:CreateElement("Slider", sliderData)
            return slider
        end
        
        function sectionInterface:AddDropdown(dropdownData)
            local dropdown = self:CreateElement("Dropdown", dropdownData)
            return dropdown
        end
        
        function sectionInterface:AddParagraph(paragraphData)
            local paragraph = self:CreateElement("Paragraph", paragraphData)
            return paragraph
        end
        
        function sectionInterface:AddKeybind(keybindData)
            local keybind = self:CreateElement("Keybind", keybindData)
            return keybind
        end
        
        function sectionInterface:AddColorPicker(colorData)
            local colorPicker = self:CreateElement("ColorPicker", colorData)
            return colorPicker
        end
        
        function sectionInterface:CreateElement(elementType, elementData)
            -- This would contain the element creation logic
            -- For brevity, returning placeholder
            return {Type = elementType, Data = elementData}
        end
        
        return sectionInterface
    end
    
    return tabInterface
end

function Window:SwitchTab(tab)
    if self.ActiveTab then
        self.ActiveTab.Active = false
        self.ActiveTab.Button.BackgroundColor3 = Config.Themes[CurrentTheme].Primary
        self.ActiveTab.ButtonLabel.TextColor3 = Config.Themes[CurrentTheme].SubText
        self.ActiveTab.ContentFrame.Visible = false
    end
    
    tab.Active = true
    tab.Button.BackgroundColor3 = Config.Themes[CurrentTheme].Accent
    tab.ButtonLabel.TextColor3 = Config.Themes[CurrentTheme].Text
    tab.ContentFrame.Visible = true
    
    self.ActiveTab = tab
end

function Window:Toggle()
    self.Visible = not self.Visible
    self.Container.Visible = self.Visible
end

function Window:Destroy()
    self.ScreenGui:Destroy()
    
    for i, window in ipairs(ActiveWindows) do
        if window == self then
            table.remove(ActiveWindows, i)
            break
        end
    end
end

--// Public API
function PremiumUI:CreateWindow(windowData)
    return Window.new(windowData.Title, windowData)
end

function PremiumUI:Notify(notificationData)
    return NotificationService:Create(notificationData)
end

function PremiumUI:SetTheme(themeName)
    if Config.Themes[themeName] then
        CurrentTheme = themeName
        -- Here you would update all windows with new theme
    end
end

function PremiumUI:SetWatermark(watermarkData)
    -- Watermark implementation
end

function PremiumUI:CreateKeySystem(keySystemData)
    -- Key system implementation
end

return PremiumUI
