--// premium-ui.lua

local PremiumUI = {}
PremiumUI.__index = PremiumUI

--// Dependencies
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

--// Configuration
local Config = {
    Themes = {
        Dark = {
            Primary = Color3.fromRGB(15, 17, 22),
            Secondary = Color3.fromRGB(25, 28, 35),
            Tertiary = Color3.fromRGB(35, 38, 45),
            Accent = Color3.fromRGB(0, 145, 255),
            Text = Color3.fromRGB(245, 247, 250),
            SubText = Color3.fromRGB(160, 165, 175),
            Border = Color3.fromRGB(45, 50, 60, 0.15),
            Divider = Color3.fromRGB(50, 55, 65, 0.3),
            Success = Color3.fromRGB(46, 204, 113),
            Error = Color3.fromRGB(231, 76, 60),
            Warning = Color3.fromRGB(241, 196, 15),
            Info = Color3.fromRGB(52, 152, 219)
        },
        Midnight = {
            Primary = Color3.fromRGB(10, 12, 18),
            Secondary = Color3.fromRGB(20, 23, 30),
            Tertiary = Color3.fromRGB(30, 33, 40),
            Accent = Color3.fromRGB(155, 89, 182),
            Text = Color3.fromRGB(235, 237, 240),
            SubText = Color3.fromRGB(140, 145, 155)
        }
    },
    
    Window = {
        Size = {600, 450},
        MinSize = {400, 300},
        MaxSize = {1200, 800},
        CornerRadius = 12,
        ShadowBlur = 24,
        ShadowTransparency = 0.8,
        Padding = 16
    },
    
    TitleBar = {
        Height = 48,
        Font = Enum.Font.GothamSemibold,
        TitleSize = 20,
        SubTitleSize = 14
    },
    
    Sidebar = {
        Width = 180,
        ItemHeight = 42,
        IconSize = 20,
        Font = Enum.Font.Gotham,
        FontSize = 14
    },
    
    Elements = {
        Height = 42,
        Font = Enum.Font.Gotham,
        FontSize = 14,
        CornerRadius = 8,
        IconSize = 20,
        Padding = 12,
        Spacing = 8
    },
    
    Notifications = {
        MaxCount = 5,
        Duration = 5,
        Width = 350,
        Height = 80,
        Spacing = 12
    }
}

--// Internal State
local ActiveWindows = {}
local ActiveNotifications = {}
local CurrentTheme = "Dark"

--// Utility Functions
local function Create(className, properties)
    local instance = Instance.new(className)
    
    for property, value in pairs(properties) do
        if property ~= "Parent" then
            if typeof(value) == "Color3" then
                instance[property] = Color3.new(value.R, value.G, value.B)
            else
                instance[property] = value
            end
        end
    end
    
    if properties.Parent then
        instance.Parent = properties.Parent
    end
    
    return instance
end

local function ApplyCorner(instance, radius)
    local corner = Create("UICorner", {
        CornerRadius = UDim.new(0, radius or Config.Elements.CornerRadius),
        Parent = instance
    })
    return corner
end

local function ApplyStroke(instance, color, thickness)
    local stroke = Create("UIStroke", {
        Parent = instance,
        Color = color or Config.Themes[CurrentTheme].Border,
        Thickness = thickness or 1,
        Transparency = 0.5
    })
    return stroke
end

local function ApplyPadding(instance, left, top, right, bottom)
    local padding = Create("UIPadding", {
        Parent = instance,
        PaddingLeft = UDim.new(0, left or 0),
        PaddingTop = UDim.new(0, top or 0),
        PaddingRight = UDim.new(0, right or 0),
        PaddingBottom = UDim.new(0, bottom or 0)
    })
    return padding
end

local function ApplyListLayout(instance, padding, horizontalAlignment)
    local layout = Create("UIListLayout", {
        Parent = instance,
        Padding = UDim.new(0, padding or Config.Elements.Spacing),
        SortOrder = Enum.SortOrder.LayoutOrder,
        HorizontalAlignment = horizontalAlignment or Enum.HorizontalAlignment.Left
    })
    return layout
end

local function CreateIcon(parent, icon, size, color)
    local iconLabel = Create("TextLabel", {
        Parent = parent,
        BackgroundTransparency = 1,
        Text = icon or "",
        TextColor3 = color or Config.Themes[CurrentTheme].SubText,
        TextSize = size or Config.Elements.IconSize,
        Font = Enum.Font.GothamSemibold,
        Size = UDim2.new(0, size, 0, size),
        TextXAlignment = Enum.TextXAlignment.Center,
        TextYAlignment = Enum.TextYAlignment.Center
    })
    return iconLabel
end

local function CreateShadow(instance)
    local shadow = Create("ImageLabel", {
        Parent = instance,
        Size = UDim2.new(1, Config.Window.ShadowBlur, 1, Config.Window.ShadowBlur),
        Position = UDim2.new(0, -Config.Window.ShadowBlur/2, 0, -Config.Window.ShadowBlur/2),
        BackgroundTransparency = 1,
        Image = "rbxassetid://5554236805",
        ImageColor3 = Color3.new(0, 0, 0),
        ImageTransparency = Config.Window.ShadowTransparency,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(23, 23, 277, 277)
    })
    return shadow
end

--// Notification System
local NotificationService = {}

function NotificationService:Create(notificationData)
    local theme = Config.Themes[CurrentTheme]
    
    local notification = Create("Frame", {
        Name = "Notification",
        Parent = game:GetService("CoreGui"),
        Size = UDim2.new(0, Config.Notifications.Width, 0, Config.Notifications.Height),
        Position = UDim2.new(1, -Config.Notifications.Width - 20, 1, -Config.Notifications.Height - 20),
        BackgroundColor3 = theme.Secondary,
        BorderSizePixel = 0
    })
    
    ApplyCorner(notification, 8)
    ApplyStroke(notification)
    
    local content = Create("Frame", {
        Parent = notification,
        Size = UDim2.new(1, -20, 1, -20),
        Position = UDim2.new(0, 10, 0, 10),
        BackgroundTransparency = 1
    })
    
    ApplyPadding(content, 8, 8, 8, 8)
    ApplyListLayout(content, 6)
    
    local title = Create("TextLabel", {
        Parent = content,
        Size = UDim2.new(1, 0, 0, 20),
        BackgroundTransparency = 1,
        Text = notificationData.Title or "Notification",
        TextColor3 = theme.Text,
        TextSize = 16,
        Font = Enum.Font.GothamSemibold,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Center
    })
    
    local message = Create("TextLabel", {
        Parent = content,
        Size = UDim2.new(1, 0, 0, 16),
        BackgroundTransparency = 1,
        Text = notificationData.Content or "",
        TextColor3 = theme.SubText,
        TextSize = 14,
        Font = Enum.Font.Gotham,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Center,
        TextWrapped = true
    })
    
    local progressBar = Create("Frame", {
        Parent = notification,
        Size = UDim2.new(0, 0, 0, 2),
        Position = UDim2.new(0, 0, 1, -2),
        BackgroundColor3 = theme.Accent,
        BorderSizePixel = 0
    })
    
    ApplyCorner(progressBar, 1)
    
    -- Animation
    notification.Position = UDim2.new(1, Config.Notifications.Width + 20, 1, -Config.Notifications.Height - 20)
    
    TweenService:Create(notification, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Position = UDim2.new(1, -Config.Notifications.Width - 20, 1, -Config.Notifications.Height - 20)
    }):Play()
    
    TweenService:Create(progressBar, TweenInfo.new(notificationData.Duration or Config.Notifications.Duration, Enum.EasingStyle.Linear), {
        Size = UDim2.new(1, 0, 0, 2)
    }):Play()
    
    task.spawn(function()
        task.wait(notificationData.Duration or Config.Notifications.Duration)
        
        TweenService:Create(notification, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Position = UDim2.new(1, Config.Notifications.Width + 20, 1, -Config.Notifications.Height - 20)
        }):Play()
        
        task.wait(0.3)
        notification:Destroy()
    end)
    
    return notification
end

--// Window Class
local Window = {}
Window.__index = Window

function Window.new(title, options)
    local self = setmetatable({}, Window)
    
    self.Title = title or "Premium UI"
    self.Options = options or {}
    self.Tabs = {}
    self.ActiveTab = nil
    self.Visible = true
    self.TabCount = 0
    
    self:InitializeUI()
    self:SetupDrag()
    
    table.insert(ActiveWindows, self)
    
    return self
end

function Window:InitializeUI()
    local theme = Config.Themes[CurrentTheme]
    
    -- Create main screen GUI
    self.ScreenGui = Create("ScreenGui", {
        Name = "PremiumUI_" .. self.Title,
        Parent = game:GetService("CoreGui"),
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    })
    
    -- Container
    self.Container = Create("Frame", {
        Parent = self.ScreenGui,
        Size = UDim2.new(0, Config.Window.Size[1], 0, Config.Window.Size[2]),
        Position = UDim2.new(0.5, -Config.Window.Size[1]/2, 0.5, -Config.Window.Size[2]/2),
        BackgroundTransparency = 1
    })
    
    -- Shadow
    CreateShadow(self.Container)
    
    -- Main window
    self.MainFrame = Create("Frame", {
        Parent = self.Container,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = theme.Primary,
        BorderSizePixel = 0
    })
    
    ApplyCorner(self.MainFrame, Config.Window.CornerRadius)
    
    -- Title bar
    self:CreateTitleBar()
    
    -- Sidebar
    self:CreateSidebar()
    
    -- Content area
    self:CreateContentArea()
end

function Window:CreateTitleBar()
    local theme = Config.Themes[CurrentTheme]
    
    self.TitleBar = Create("Frame", {
        Parent = self.MainFrame,
        Size = UDim2.new(1, 0, 0, Config.TitleBar.Height),
        BackgroundColor3 = theme.Secondary,
        BorderSizePixel = 0
    })
    
    ApplyCorner(self.TitleBar, Config.Window.CornerRadius)
    
    local titleContent = Create("Frame", {
        Parent = self.TitleBar,
        Size = UDim2.new(1, -40, 1, 0),
        Position = UDim2.new(0, 20, 0, 0),
        BackgroundTransparency = 1
    })
    
    self.TitleLabel = Create("TextLabel", {
        Parent = titleContent,
        Size = UDim2.new(1, 0, 0.6, 0),
        BackgroundTransparency = 1,
        Text = self.Title,
        TextColor3 = theme.Text,
        TextSize = Config.TitleBar.TitleSize,
        Font = Config.TitleBar.Font,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Bottom
    })
    
    if self.Options.SubTitle then
        self.SubTitleLabel = Create("TextLabel", {
            Parent = titleContent,
            Size = UDim2.new(1, 0, 0.4, 0),
            Position = UDim2.new(0, 0, 0.6, 0),
            BackgroundTransparency = 1,
            Text = self.Options.SubTitle,
            TextColor3 = theme.SubText,
            TextSize = Config.TitleBar.SubTitleSize,
            Font = Enum.Font.Gotham,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextYAlignment = Enum.TextYAlignment.Top
        })
    end
end

function Window:CreateSidebar()
    local theme = Config.Themes[CurrentTheme]
    
    self.Sidebar = Create("Frame", {
        Parent = self.MainFrame,
        Size = UDim2.new(0, Config.Sidebar.Width, 1, -Config.TitleBar.Height),
        Position = UDim2.new(0, 0, 0, Config.TitleBar.Height),
        BackgroundColor3 = theme.Secondary,
        BorderSizePixel = 0
    })
    
    self.TabList = Create("ScrollingFrame", {
        Parent = self.Sidebar,
        Size = UDim2.new(1, 0, 1, -60),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        ScrollBarThickness = 2,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        AutomaticCanvasSize = Enum.AutomaticSize.Y
    })
    
    ApplyPadding(self.TabList, 8, 8, 8, 8)
    ApplyListLayout(self.TabList, 4)
end

function Window:CreateContentArea()
    local theme = Config.Themes[CurrentTheme]
    
    self.ContentArea = Create("Frame", {
        Parent = self.MainFrame,
        Size = UDim2.new(1, -Config.Sidebar.Width, 1, -Config.TitleBar.Height),
        Position = UDim2.new(0, Config.Sidebar.Width, 0, Config.TitleBar.Height),
        BackgroundColor3 = theme.Primary,
        BorderSizePixel = 0,
        ClipsDescendants = true
    })
    
    ApplyCorner(self.ContentArea, Config.Window.CornerRadius)
    
    self.ContentScroll = Create("ScrollingFrame", {
        Parent = self.ContentArea,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        ScrollBarThickness = 4,
        ScrollBarImageColor3 = theme.Divider,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        AutomaticCanvasSize = Enum.AutomaticSize.Y
    })
    
    ApplyPadding(self.ContentScroll, Config.Window.Padding, Config.Window.Padding, Config.Window.Padding, Config.Window.Padding)
end

function Window:SetupDrag()
    local dragging = false
    local dragStart, startPos
    
    self.TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = self.Container.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            self.Container.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
end

function Window:CreateTab(tabData)
    local theme = Config.Themes[CurrentTheme]
    
    local tab = {
        Id = "Tab_" .. self.TabCount,
        Title = tabData.Title or "Tab",
        Icon = tabData.Icon or "",
        Priority = tabData.Priority or self.TabCount + 1,
        Sections = {},
        Active = false
    }
    
    self.TabCount = self.TabCount + 1
    
    -- Create sidebar button
    local tabButton = Create("TextButton", {
        Parent = self.TabList,
        Size = UDim2.new(1, 0, 0, Config.Sidebar.ItemHeight),
        BackgroundColor3 = theme.Primary,
        Text = "",
        AutoButtonColor = false,
        BorderSizePixel = 0,
        LayoutOrder = tab.Priority
    })
    
    ApplyCorner(tabButton, 6)
    
    if tab.Icon ~= "" then
        local iconLabel = CreateIcon(tabButton, tab.Icon, Config.Sidebar.IconSize)
        iconLabel.Position = UDim2.new(0, 12, 0.5, -Config.Sidebar.IconSize/2)
    end
    
    local textOffset = tab.Icon ~= "" and (Config.Sidebar.IconSize + 20) or 12
    
    local buttonLabel = Create("TextLabel", {
        Parent = tabButton,
        Size = UDim2.new(1, -textOffset, 1, 0),
        Position = UDim2.new(0, textOffset, 0, 0),
        BackgroundTransparency = 1,
        Text = tab.Title,
        TextColor3 = theme.SubText,
        TextSize = Config.Sidebar.FontSize,
        Font = Config.Sidebar.Font,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Center
    })
    
    -- Create content frame
    local contentFrame = Create("Frame", {
        Parent = self.ContentScroll,
        Size = UDim2.new(1, 0, 0, 0),
        BackgroundTransparency = 1,
        Visible = false
    })
    
    ApplyListLayout(contentFrame, Config.Elements.Spacing)
    
    -- Tab button click handler
    tabButton.MouseButton1Click:Connect(function()
        self:SwitchTab(tab)
    end)
    
    -- Store references
    tab.Button = tabButton
    tab.ContentFrame = contentFrame
    tab.ButtonLabel = buttonLabel
    
    -- Initialize as first tab if needed
    if #self.Tabs == 0 then
        self:SwitchTab(tab)
    end
    
    table.insert(self.Tabs, tab)
    
    -- Return tab interface
    local tabInterface = {}
    
    function tabInterface:CreateSection(sectionData)
        local section = {
            Title = sectionData.Title,
            Description = sectionData.Description,
            Elements = {}
        }
        
        local sectionContainer = Create("Frame", {
            Parent = contentFrame,
            Size = UDim2.new(1, 0, 0, 0),
            BackgroundTransparency = 1
        })
        
        ApplyListLayout(sectionContainer, Config.Elements.Spacing)
        
        -- Section header
        if section.Title then
            local header = Create("Frame", {
                Parent = sectionContainer,
                Size = UDim2.new(1, 0, 0, section.Description and 36 or 24),
                BackgroundTransparency = 1
            })
            
            local titleLabel = Create("TextLabel", {
                Parent = header,
                Size = section.Description and UDim2.new(1, 0, 0, 20) or UDim2.new(1, 0, 1, 0),
                BackgroundTransparency = 1,
                Text = string.upper(section.Title),
                TextColor3 = theme.SubText,
                TextSize = 12,
                Font = Enum.Font.GothamSemibold,
                TextXAlignment = Enum.TextXAlignment.Left,
                TextYAlignment = Enum.TextYAlignment.Center
            })
            
            if section.Description then
                local descriptionLabel = Create("TextLabel", {
                    Parent = header,
                    Size = UDim2.new(1, 0, 0, 16),
                    Position = UDim2.new(0, 0, 0, 20),
                    BackgroundTransparency = 1,
                    Text = section.Description,
                    TextColor3 = theme.SubText,
                    TextSize = 12,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    TextYAlignment = Enum.TextYAlignment.Top
                })
            end
        end
        
        section.Container = sectionContainer
        table.insert(tab.Sections, section)
        
        -- Section methods (COMPLETED IMPLEMENTATION)
        local sectionInterface = {}
        
        function sectionInterface:AddButton(buttonData)
            local element = self:CreateElement("Button", buttonData)
            return element
        end
        
        function sectionInterface:AddToggle(toggleData)
            local element = self:CreateElement("Toggle", toggleData)
            return element
        end
        
        function sectionInterface:AddSlider(sliderData)
            local element = self:CreateElement("Slider", sliderData)
            return element
        end
        
        function sectionInterface:AddDropdown(dropdownData)
            local element = self:CreateElement("Dropdown", dropdownData)
            return element
        end
        
        function sectionInterface:AddParagraph(paragraphData)
            local element = self:CreateElement("Paragraph", paragraphData)
            return element
        end
        
        function sectionInterface:AddKeybind(keybindData)
            local element = self:CreateElement("Keybind", keybindData)
            return element
        end
        
        function sectionInterface:AddColorPicker(colorData)
            local element = self:CreateElement("ColorPicker", colorData)
            return element
        end
        
        function sectionInterface:CreateElement(elementType, elementData)
            local theme = Config.Themes[CurrentTheme]
            local element = {}
            
            if elementType == "Button" then
                -- Create button container
                local buttonContainer = Create("Frame", {
                    Parent = section.Container,
                    Size = UDim2.new(1, 0, 0, Config.Elements.Height),
                    BackgroundTransparency = 1
                })
                
                local button = Create("TextButton", {
                    Parent = buttonContainer,
                    Size = UDim2.new(1, 0, 1, 0),
                    BackgroundColor3 = theme.Secondary,
                    Text = "",
                    AutoButtonColor = false,
                    BorderSizePixel = 0
                })
                
                ApplyCorner(button)
                ApplyStroke(button)
                
                -- Button content
                local buttonContent = Create("Frame", {
                    Parent = button,
                    Size = UDim2.new(1, -20, 1, 0),
                    Position = UDim2.new(0, 10, 0, 0),
                    BackgroundTransparency = 1
                })
                
                local buttonText = Create("TextLabel", {
                    Parent = buttonContent,
                    Size = UDim2.new(1, 0, 1, 0),
                    BackgroundTransparency = 1,
                    Text = elementData.Title or "Button",
                    TextColor3 = elementData.Color or theme.Text,
                    TextSize = Config.Elements.FontSize,
                    Font = Config.Elements.Font,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    TextYAlignment = Enum.TextYAlignment.Center
                })
                
                if elementData.Description then
                    buttonText.Text = elementData.Title or "Button"
                    local descLabel = Create("TextLabel", {
                        Parent = buttonContent,
                        Size = UDim2.new(1, 0, 0, 14),
                        Position = UDim2.new(0, 0, 1, -14),
                        BackgroundTransparency = 1,
                        Text = elementData.Description,
                        TextColor3 = theme.SubText,
                        TextSize = 12,
                        Font = Enum.Font.Gotham,
                        TextXAlignment = Enum.TextXAlignment.Left,
                        TextYAlignment = Enum.TextYAlignment.Top
                    })
                end
                
                -- Button click handler
                button.MouseButton1Click:Connect(function()
                    if elementData.Callback then
                        elementData.Callback()
                    end
                end)
                
                -- Hover effects
                button.MouseEnter:Connect(function()
                    TweenService:Create(button, TweenInfo.new(0.2), {
                        BackgroundColor3 = theme.Tertiary
                    }):Play()
                end)
                
                button.MouseLeave:Connect(function()
                    TweenService:Create(button, TweenInfo.new(0.2), {
                        BackgroundColor3 = theme.Secondary
                    }):Play()
                end)
                
                element.Instance = button
                element.SetText = function(text)
                    buttonText.Text = text
                end
                
            elseif elementType == "Toggle" then
                -- Create toggle container
                local toggleContainer = Create("Frame", {
                    Parent = section.Container,
                    Size = UDim2.new(1, 0, 0, Config.Elements.Height),
                    BackgroundTransparency = 1
                })
                
                local toggleBackground = Create("Frame", {
                    Parent = toggleContainer,
                    Size = UDim2.new(1, 0, 1, 0),
                    BackgroundColor3 = theme.Secondary,
                    BorderSizePixel = 0
                })
                
                ApplyCorner(toggleBackground)
                ApplyStroke(toggleBackground)
                
                local toggleContent = Create("Frame", {
                    Parent = toggleBackground,
                    Size = UDim2.new(1, -20, 1, 0),
                    Position = UDim2.new(0, 10, 0, 0),
                    BackgroundTransparency = 1
                })
                
                local toggleText = Create("TextLabel", {
                    Parent = toggleContent,
                    Size = UDim2.new(1, -40, 1, 0),
                    BackgroundTransparency = 1,
                    Text = elementData.Title or "Toggle",
                    TextColor3 = theme.Text,
                    TextSize = Config.Elements.FontSize,
                    Font = Config.Elements.Font,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    TextYAlignment = Enum.TextYAlignment.Center
                })
                
                if elementData.Description then
                    toggleText.Size = UDim2.new(1, -40, 0.5, 0)
                    local descLabel = Create("TextLabel", {
                        Parent = toggleContent,
                        Size = UDim2.new(1, -40, 0.5, 0),
                        Position = UDim2.new(0, 0, 0.5, 0),
                        BackgroundTransparency = 1,
                        Text = elementData.Description,
                        TextColor3 = theme.SubText,
                        TextSize = 12,
                        Font = Enum.Font.Gotham,
                        TextXAlignment = Enum.TextXAlignment.Left,
                        TextYAlignment = Enum.TextYAlignment.Top
                    })
                end
                
                -- Toggle switch
                local toggleSwitch = Create("Frame", {
                    Parent = toggleContent,
                    Size = UDim2.new(0, 30, 0, 16),
                    Position = UDim2.new(1, -30, 0.5, -8),
                    BackgroundColor3 = theme.Tertiary,
                    BorderSizePixel = 0
                })
                
                ApplyCorner(toggleSwitch, 8)
                
                local toggleDot = Create("Frame", {
                    Parent = toggleSwitch,
                    Size = UDim2.new(0, 12, 0, 12),
                    Position = UDim2.new(0, 2, 0.5, -6),
                    BackgroundColor3 = theme.SubText,
                    BorderSizePixel = 0
                })
                
                ApplyCorner(toggleDot, 6)
                
                local isToggled = elementData.Default or false
                
                -- Update toggle state
                local function updateToggle()
                    if isToggled then
                        TweenService:Create(toggleDot, TweenInfo.new(0.2), {
                            Position = UDim2.new(1, -14, 0.5, -6),
                            BackgroundColor3 = theme.Accent
                        }):Play()
                        TweenService:Create(toggleSwitch, TweenInfo.new(0.2), {
                            BackgroundColor3 = theme.Accent
                        }):Play()
                    else
                        TweenService:Create(toggleDot, TweenInfo.new(0.2), {
                            Position = UDim2.new(0, 2, 0.5, -6),
                            BackgroundColor3 = theme.SubText
                        }):Play()
                        TweenService:Create(toggleSwitch, TweenInfo.new(0.2), {
                            BackgroundColor3 = theme.Tertiary
                        }):Play()
                    end
                end
                
                updateToggle()
                
                -- Toggle click handler
                toggleBackground.MouseButton1Click:Connect(function()
                    isToggled = not isToggled
                    updateToggle()
                    
                    if elementData.Callback then
                        elementData.Callback(isToggled)
                    end
                end)
                
                element.Instance = toggleBackground
                element.SetState = function(state)
                    isToggled = state
                    updateToggle()
                end
                element.GetState = function()
                    return isToggled
                end
                
            elseif elementType == "Slider" then
                -- Create slider container
                local sliderContainer = Create("Frame", {
                    Parent = section.Container,
                    Size = UDim2.new(1, 0, 0, 56),
                    BackgroundTransparency = 1
                })
                
                local sliderBackground = Create("Frame", {
                    Parent = sliderContainer,
                    Size = UDim2.new(1, 0, 0, 24),
                    BackgroundColor3 = theme.Secondary,
                    BorderSizePixel = 0
                })
                
                ApplyCorner(sliderBackground, 12)
                
                local sliderContent = Create("Frame", {
                    Parent = sliderBackground,
                    Size = UDim2.new(1, -20, 1, 0),
                    Position = UDim2.new(0, 10, 0, 0),
                    BackgroundTransparency = 1
                })
                
                local sliderText = Create("TextLabel", {
                    Parent = sliderContent,
                    Size = UDim2.new(1, 0, 1, 0),
                    BackgroundTransparency = 1,
                    Text = elementData.Title or "Slider",
                    TextColor3 = theme.Text,
                    TextSize = Config.Elements.FontSize,
                    Font = Config.Elements.Font,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    TextYAlignment = Enum.TextYAlignment.Center
                })
                
                -- Value display
                local valueLabel = Create("TextLabel", {
                    Parent = sliderContent,
                    Size = UDim2.new(0, 40, 1, 0),
                    Position = UDim2.new(1, -40, 0, 0),
                    BackgroundTransparency = 1,
                    Text = tostring(elementData.Default or elementData.Min or 0),
                    TextColor3 = theme.SubText,
                    TextSize = Config.Elements.FontSize,
                    Font = Config.Elements.Font,
                    TextXAlignment = Enum.TextXAlignment.Right,
                    TextYAlignment = Enum.TextYAlignment.Center
                })
                
                if elementData.Description then
                    local descLabel = Create("TextLabel", {
                        Parent = sliderContainer,
                        Size = UDim2.new(1, 0, 0, 16),
                        Position = UDim2.new(0, 0, 0, 24),
                        BackgroundTransparency = 1,
                        Text = elementData.Description,
                        TextColor3 = theme.SubText,
                        TextSize = 12,
                        Font = Enum.Font.Gotham,
                        TextXAlignment = Enum.TextXAlignment.Left,
                        TextYAlignment = Enum.TextYAlignment.Top
                    })
                end
                
                -- Slider track
                local sliderTrack = Create("Frame", {
                    Parent = sliderContainer,
                    Size = UDim2.new(1, 0, 0, 4),
                    Position = UDim2.new(0, 0, 0, 44),
                    BackgroundColor3 = theme.Tertiary,
                    BorderSizePixel = 0
                })
                
                ApplyCorner(sliderTrack, 2)
                
                local sliderFill = Create("Frame", {
                    Parent = sliderTrack,
                    Size = UDim2.new(0, 0, 1, 0),
                    BackgroundColor3 = theme.Accent,
                    BorderSizePixel = 0
                })
                
                ApplyCorner(sliderFill, 2)
                
                local sliderDot = Create("Frame", {
                    Parent = sliderTrack,
                    Size = UDim2.new(0, 12, 0, 12),
                    Position = UDim2.new(0, 0, 0.5, -6),
                    BackgroundColor3 = theme.Text,
                    BorderSizePixel = 0
                })
                
                ApplyCorner(sliderDot, 6)
                ApplyStroke(sliderDot)
                
                local minValue = elementData.Min or 0
                local maxValue = elementData.Max or 100
                local increment = elementData.Increment or 1
                local currentValue = elementData.Default or minValue
                
                -- Update slider display
                local function updateSlider()
                    local percentage = (currentValue - minValue) / (maxValue - minValue)
                    sliderFill.Size = UDim2.new(percentage, 0, 1, 0)
                    sliderDot.Position = UDim2.new(percentage, -6, 0.5, -6)
                    valueLabel.Text = tostring(currentValue)
                    
                    if elementData.Callback then
                        elementData.Callback(currentValue)
                    end
                end
                
                updateSlider()
                
                -- Slider interaction
                local dragging = false
                
                local function updateValueFromPosition(x)
                    local relativeX = math.clamp(x, 0, sliderTrack.AbsoluteSize.X)
                    local percentage = relativeX / sliderTrack.AbsoluteSize.X
                    local value = minValue + (maxValue - minValue) * percentage
                    
                    -- Apply increment
                    if increment > 0 then
                        value = math.floor(value / increment) * increment
                    end
                    
                    value = math.clamp(value, minValue, maxValue)
                    
                    if value ~= currentValue then
                        currentValue = value
                        updateSlider()
                    end
                end
                
                sliderTrack.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        dragging = true
                        updateValueFromPosition(input.Position.X - sliderTrack.AbsolutePosition.X)
                    end
                end)
                
                sliderTrack.InputEnded:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        dragging = false
                    end
                end)
                
                UserInputService.InputChanged:Connect(function(input)
                    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                        updateValueFromPosition(input.Position.X - sliderTrack.AbsolutePosition.X)
                    end
                end)
                
                element.Instance = sliderContainer
                element.SetValue = function(value)
                    currentValue = math.clamp(value, minValue, maxValue)
                    updateSlider()
                end
                element.GetValue = function()
                    return currentValue
                end
                
            elseif elementType == "Paragraph" then
                -- Create paragraph container
                local paragraphContainer = Create("Frame", {
                    Parent = section.Container,
                    Size = UDim2.new(1, 0, 0, 60),
                    BackgroundTransparency = 1
                })
                
                local paragraphBackground = Create("Frame", {
                    Parent = paragraphContainer,
                    Size = UDim2.new(1, 0, 1, 0),
                    BackgroundColor3 = theme.Secondary,
                    BorderSizePixel = 0
                })
                
                ApplyCorner(paragraphBackground)
                ApplyStroke(paragraphBackground)
                
                local paragraphContent = Create("Frame", {
                    Parent = paragraphBackground,
                    Size = UDim2.new(1, -20, 1, -20),
                    Position = UDim2.new(0, 10, 0, 10),
                    BackgroundTransparency = 1
                })
                
                local paragraphText = Create("TextLabel", {
                    Parent = paragraphContent,
                    Size = UDim2.new(1, 0, 1, 0),
                    BackgroundTransparency = 1,
                    Text = elementData.Text or "",
                    TextColor3 = elementData.Color or theme.SubText,
                    TextSize = 14,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    TextYAlignment = Enum.TextYAlignment.Top,
                    TextWrapped = true
                })
                
                element.Instance = paragraphContainer
                element.SetText = function(text)
                    paragraphText.Text = text
                end
                
            elseif elementType == "Dropdown" then
                -- Create dropdown container
                local dropdownContainer = Create("Frame", {
                    Parent = section.Container,
                    Size = UDim2.new(1, 0, 0, Config.Elements.Height),
                    BackgroundTransparency = 1
                })
                
                local dropdownBackground = Create("TextButton", {
                    Parent = dropdownContainer,
                    Size = UDim2.new(1, 0, 1, 0),
                    BackgroundColor3 = theme.Secondary,
                    Text = "",
                    AutoButtonColor = false,
                    BorderSizePixel = 0
                })
                
                ApplyCorner(dropdownBackground)
                ApplyStroke(dropdownBackground)
                
                local dropdownContent = Create("Frame", {
                    Parent = dropdownBackground,
                    Size = UDim2.new(1, -40, 1, 0),
                    Position = UDim2.new(0, 10, 0, 0),
                    BackgroundTransparency = 1
                })
                
                local dropdownText = Create("TextLabel", {
                    Parent = dropdownContent,
                    Size = UDim2.new(1, 0, 1, 0),
                    BackgroundTransparency = 1,
                    Text = elementData.Title or "Dropdown",
                    TextColor3 = theme.Text,
                    TextSize = Config.Elements.FontSize,
                    Font = Config.Elements.Font,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    TextYAlignment = Enum.TextYAlignment.Center
                })
                
                local dropdownIcon = Create("TextLabel", {
                    Parent = dropdownBackground,
                    Size = UDim2.new(0, 20, 0, 20),
                    Position = UDim2.new(1, -30, 0.5, -10),
                    BackgroundTransparency = 1,
                    Text = "â–¼",
                    TextColor3 = theme.SubText,
                    TextSize = 12,
                    Font = Enum.Font.Gotham,
                    TextXAlignment = Enum.TextXAlignment.Center,
                    TextYAlignment = Enum.TextYAlignment.Center
                })
                
                -- Dropdown options
                local dropdownList = Create("Frame", {
                    Parent = dropdownContainer,
                    Size = UDim2.new(1, 0, 0, 0),
                    Position = UDim2.new(0, 0, 1, 4),
                    BackgroundColor3 = theme.Secondary,
                    Visible = false,
                    ClipsDescendants = true
                })
                
                ApplyCorner(dropdownList, 8)
                ApplyStroke(dropdownList)
                
                local optionsFrame = Create("ScrollingFrame", {
                    Parent = dropdownList,
                    Size = UDim2.new(1, 0, 1, 0),
                    BackgroundTransparency = 1,
                    ScrollBarThickness = 2,
                    CanvasSize = UDim2.new(0, 0, 0, 0),
                    AutomaticCanvasSize = Enum.AutomaticSize.Y
                })
                
                ApplyListLayout(optionsFrame, 0)
                
                local isOpen = false
                local options = elementData.Options or {}
                local selected = elementData.Default or (options[1] or "")
                
                -- Update dropdown display
                local function updateDropdown()
                    dropdownText.Text = elementData.Title .. ": " .. selected
                end
                
                updateDropdown()
                
                -- Create option buttons
                local function createOptions()
                    optionsFrame:ClearAllChildren()
                    
                    for _, option in ipairs(options) do
                        local optionButton = Create("TextButton", {
                            Parent = optionsFrame,
                            Size = UDim2.new(1, 0, 0, 32),
                            BackgroundColor3 = theme.Secondary,
                            Text = "",
                            AutoButtonColor = false,
                            BorderSizePixel = 0
                        })
                        
                        local optionText = Create("TextLabel", {
                            Parent = optionButton,
                            Size = UDim2.new(1, -20, 1, 0),
                            Position = UDim2.new(0, 10, 0, 0),
                            BackgroundTransparency = 1,
                            Text = option,
                            TextColor3 = theme.Text,
                            TextSize = 14,
                            Font = Enum.Font.Gotham,
                            TextXAlignment = Enum.TextXAlignment.Left,
                            TextYAlignment = Enum.TextYAlignment.Center
                        })
                        
                        optionButton.MouseButton1Click:Connect(function()
                            selected = option
                            updateDropdown()
                            isOpen = false
                            dropdownList.Visible = false
                            TweenService:Create(dropdownIcon, TweenInfo.new(0.2), {
                                Rotation = 0
                            }):Play()
                            
                            if elementData.Callback then
                                elementData.Callback(option)
                            end
                        end)
                        
                        optionButton.MouseEnter:Connect(function()
                            TweenService:Create(optionButton, TweenInfo.new(0.2), {
                                BackgroundColor3 = theme.Tertiary
                            }):Play()
                        end)
                        
                        optionButton.MouseLeave:Connect(function()
                            TweenService:Create(optionButton, TweenInfo.new(0.2), {
                                BackgroundColor3 = theme.Secondary
                            }):Play()
                        end)
                    end
                end
                
                createOptions()
                
                -- Toggle dropdown
                dropdownBackground.MouseButton1Click:Connect(function()
                    isOpen = not isOpen
                    
                    if isOpen then
                        dropdownList.Visible = true
                        TweenService:Create(dropdownList, TweenInfo.new(0.2), {
                            Size = UDim2.new(1, 0, 0, math.min(#options * 32, 160))
                        }):Play()
                        TweenService:Create(dropdownIcon, TweenInfo.new(0.2), {
                            Rotation = 180
                        }):Play()
                    else
                        TweenService:Create(dropdownList, TweenInfo.new(0.2), {
                            Size = UDim2.new(1, 0, 0, 0)
                        }):Play()
                        TweenService:Create(dropdownIcon, TweenInfo.new(0.2), {
                            Rotation = 0
                        }):Play()
                        
                        task.wait(0.2)
                        dropdownList.Visible = false
                    end
                end)
                
                element.Instance = dropdownContainer
                element.SetOptions = function(newOptions)
                    options = newOptions
                    createOptions()
                end
                element.SetSelected = function(option)
                    selected = option
                    updateDropdown()
                end
                
            elseif elementType == "Keybind" then
                -- Create keybind container
                local keybindContainer = Create("Frame", {
                    Parent = section.Container,
                    Size = UDim2.new(1, 0, 0, Config.Elements.Height),
                    BackgroundTransparency = 1
                })
                
                local keybindBackground = Create("TextButton", {
                    Parent = keybindContainer,
                    Size = UDim2.new(1, 0, 1, 0),
                    BackgroundColor3 = theme.Secondary,
                    Text = "",
                    AutoButtonColor = false,
                    BorderSizePixel = 0
                })
                
                ApplyCorner(keybindBackground)
                ApplyStroke(keybindBackground)
                
                local keybindContent = Create("Frame", {
                    Parent = keybindBackground,
                    Size = UDim2.new(1, -20, 1, 0),
                    Position = UDim2.new(0, 10, 0, 0),
                    BackgroundTransparency = 1
                })
                
                local keybindText = Create("TextLabel", {
                    Parent = keybindContent,
                    Size = UDim2.new(0.7, 0, 1, 0),
                    BackgroundTransparency = 1,
                    Text = elementData.Title or "Keybind",
                    TextColor3 = theme.Text,
                    TextSize = Config.Elements.FontSize,
                    Font = Config.Elements.Font,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    TextYAlignment = Enum.TextYAlignment.Center
                })
                
                local keybindDisplay = Create("TextButton", {
                    Parent = keybindContent,
                    Size = UDim2.new(0.3, -10, 0, 24),
                    Position = UDim2.new(0.7, 10, 0.5, -12),
                    BackgroundColor3 = theme.Tertiary,
                    Text = tostring(elementData.Default and elementData.Default.Name or "None"),
                    TextColor3 = theme.SubText,
                    TextSize = 12,
                    Font = Enum.Font.Gotham,
                    BorderSizePixel = 0
                })
                
                ApplyCorner(keybindDisplay, 6)
                
                local listening = false
                local currentKey = elementData.Default or Enum.KeyCode.Unknown
                
                -- Start listening for key press
                keybindDisplay.MouseButton1Click:Connect(function()
                    listening = true
                    keybindDisplay.Text = "..."
                    keybindDisplay.TextColor3 = theme.Accent
                    keybindDisplay.BackgroundColor3 = theme.Accent
                end)
                
                UserInputService.InputBegan:Connect(function(input, gameProcessed)
                    if listening then
                        if input.UserInputType == Enum.UserInputType.Keyboard then
                            currentKey = input.KeyCode
                            keybindDisplay.Text = input.KeyCode.Name
                            listening = false
                            keybindDisplay.TextColor3 = theme.SubText
                            keybindDisplay.BackgroundColor3 = theme.Tertiary
                        elseif input.UserInputType == Enum.UserInputType.MouseButton1 then
                            currentKey = Enum.KeyCode.LeftControl
                            keybindDisplay.Text = "Mouse1"
                            listening = false
                            keybindDisplay.TextColor3 = theme.SubText
                            keybindDisplay.BackgroundColor3 = theme.Tertiary
                        end
                    elseif input.KeyCode == currentKey and not gameProcessed and elementData.Callback then
                        elementData.Callback()
                    end
                end)
                
                element.Instance = keybindContainer
                element.SetKey = function(key)
                    currentKey = key
                    keybindDisplay.Text = key.Name
                end
                
            elseif elementType == "ColorPicker" then
                -- Create color picker container
                local colorContainer = Create("Frame", {
                    Parent = section.Container,
                    Size = UDim2.new(1, 0, 0, Config.Elements.Height),
                    BackgroundTransparency = 1
                })
                
                local colorBackground = Create("Frame", {
                    Parent = colorContainer,
                    Size = UDim2.new(1, 0, 1, 0),
                    BackgroundColor3 = theme.Secondary,
                    BorderSizePixel = 0
                })
                
                ApplyCorner(colorBackground)
                ApplyStroke(colorBackground)
                
                local colorContent = Create("Frame", {
                    Parent = colorBackground,
                    Size = UDim2.new(1, -20, 1, 0),
                    Position = UDim2.new(0, 10, 0, 0),
                    BackgroundTransparency = 1
                })
                
                local colorText = Create("TextLabel", {
                    Parent = colorContent,
                    Size = UDim2.new(0.7, 0, 1, 0),
                    BackgroundTransparency = 1,
                    Text = elementData.Title or "Color",
                    TextColor3 = theme.Text,
                    TextSize = Config.Elements.FontSize,
                    Font = Config.Elements.Font,
                    TextXAlignment = Enum.TextXAlignment.Left,
                    TextYAlignment = Enum.TextYAlignment.Center
                })
                
                local colorPreview = Create("Frame", {
                    Parent = colorContent,
                    Size = UDim2.new(0, 30, 0, 30),
                    Position = UDim2.new(0.7, 10, 0.5, -15),
                    BackgroundColor3 = elementData.Default or Color3.new(1, 1, 1),
                    BorderSizePixel = 0
                })
                
                ApplyCorner(colorPreview, 6)
                ApplyStroke(colorPreview, theme.Border)
                
                local currentColor = elementData.Default or Color3.new(1, 1, 1)
                
                colorPreview.MouseButton1Click:Connect(function()
                    -- Simple color picker (would need more complex implementation for full picker)
                    currentColor = Color3.new(math.random(), math.random(), math.random())
                    colorPreview.BackgroundColor3 = currentColor
                    
                    if elementData.Callback then
                        elementData.Callback(currentColor)
                    end
                end)
                
                element.Instance = colorContainer
                element.SetColor = function(color)
                    currentColor = color
                    colorPreview.BackgroundColor3 = color
                end
            end
            
            table.insert(section.Elements, element)
            return element
        end
        
        return sectionInterface
    end
    
    return tabInterface
end

function Window:SwitchTab(tab)
    if self.ActiveTab then
        self.ActiveTab.Active = false
        self.ActiveTab.Button.BackgroundColor3 = Config.Themes[CurrentTheme].Primary
        self.ActiveTab.ButtonLabel.TextColor3 = Config.Themes[CurrentTheme].SubText
        self.ActiveTab.ContentFrame.Visible = false
    end
    
    tab.Active = true
    tab.Button.BackgroundColor3 = Config.Themes[CurrentTheme].Accent
    tab.ButtonLabel.TextColor3 = Config.Themes[CurrentTheme].Text
    tab.ContentFrame.Visible = true
    
    self.ActiveTab = tab
end

function Window:Toggle()
    self.Visible = not self.Visible
    self.Container.Visible = self.Visible
end

function Window:Destroy()
    self.ScreenGui:Destroy()
    
    for i, window in ipairs(ActiveWindows) do
        if window == self then
            table.remove(ActiveWindows, i)
            break
        end
    end
end

--// Public API
function PremiumUI:CreateWindow(windowData)
    return Window.new(windowData.Title, windowData)
end

function PremiumUI:Notify(notificationData)
    return NotificationService:Create(notificationData)
end

function PremiumUI:SetTheme(themeName)
    if Config.Themes[themeName] then
        CurrentTheme = themeName
        -- Here you would update all windows with new theme
    end
end

function PremiumUI:SetWatermark(watermarkData)
    -- Watermark implementation
end

function PremiumUI:CreateKeySystem(keySystemData)
    -- Key system implementation
end

return PremiumUI
